version: '3.3'

services:
  mellowtel-analyzer:
    build: .
    container_name: mellowtel-network-analyzer
    volumes:
      # Mount output directory to persist network logs
      - ./output:/app/output
      # Optional: Mount extensions directory to update without rebuilding
      # - ./crx_files:/app/crx_files
      # Optional: Mount sites.txt to update without rebuilding
      - ./sites.txt:/app/sites.txt
    environment:
      # Configurable environment variables
      - DWELL_TIME=10  # Seconds to wait on each page
      - HEADLESS=false  # false = Xvfb (normal Chrome UA), true = headless (HeadlessChrome UA)
      - DISABLE_IMAGES=false  # Set to true to disable image loading for faster execution
      - DISPLAY=:99  # Virtual display provided by Xvfb
      - ENABLE_TC=${ENABLE_TC:-false}  # Enable traffic control latency simulation
    shm_size: 3gb  # Increase shared memory size for Chrome
    security_opt:
      - seccomp:unconfined  # Required for Chrome sandbox in some environments
    cap_add:
      - NET_ADMIN  # Required for tc and iptables network latency simulation
